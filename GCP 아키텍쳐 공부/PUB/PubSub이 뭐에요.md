# Pub/Sub(Publisher/ Subscriber)

Pub/ Sub는 <b>메시지를 생성하는 서비스</b>들을 <b>해당 메시지들을 처리하는 서비스로부터 <u>분리</u></b>하는 <i>비동기, 확장 가능한</i> 서비스다.

Pub/Sub는 서비스들이 비동기적으로 데이터를 주고받을 수 있도록 (100 miliseconds)의 레이턴시를 가지고 도와준다.

Pub/Sub는 주로 <b>데이터를 수집</b>하고 <b>데이터를 배포</b>하는 스트리밍 분석 및 데이터 통합 파이프라인에서 사용. 이는 서비스 통합을 위해 메시징 중심 미들웨어 또는 테스크 병렬화를 위한 queue로도 효과적입니다. 

해당 서비스를 사용하게 된다면 Publisher 및 subscriber라는 이벤트 제작자 및 소비자 시스템을 만들 수 있습니다. publisher는 동기식 리모트 procedure call이 아니라 이벤트를 브로드캐스트하여 subscriber와 비동기적으로 통신합니다.

Publisher는 이러한 이벤트가 처리되는 방식이나 시기에 관계없이 Pub/Sub 서비스에 이벤트를 보냅니다. 그런 다음 Pub/Sub는 이벤트에 응답하는 모든 서비스에 이벤트를 전송합니다. RPC(Remote Procedure call)를 통해 통신하는 시스템에서 publisher는 subscriber가 데이터를 수신할 때까지 기다려야 합니다. 그러나 Pub/Sub에서 비동기 통합은 전반적인 시스템의 유연성과 견고성을 높입니다.

## 일반 사용 사례
 * <b>사용자 상호작용 및 서버 이벤트 수집</b>: 최종 사용자 앱의 사용자 상호작용 이벤트 또는 시스템의 서버 이벤트를 사용하려면 인를 Pub/Sub로 전달해야 할 수 있습니다.  그런 후 이벤트를 데이터베이스로 전송하는 Dataflow와 같은 스트림 처리 도굴를 사용할 수 있습니다. 이러한 데이터베이스 에시에는 <i> BigQuery, Cloud Bigtable, Cloud storage</i>가 있습니다. Pub/Sub를 사용하면 여러 클라이언트의 이벤트를 동시에 수집할 수 있습니다.

 * <b>실시간 이벤트 배포: </b> raw 또는 처리된 이벤트를 팀과 조직 전체의 여러 애플리케이션에서 실시간으로 처리할 수 있습니다. 
 Pub/Sub는 '엔터프라이즈 이벤트 버스'및 이벤트 기반 애플리케이션 설계 패턴을 지원합니다. Pub/Sub를 사용하면 이벤트를 Pub/Sub를 내보내는 여러 Google 시스템과 통합 할 수 있음

 * <b>데이터베이스 간 데이터 복제: </b> <u>Pub/Sub는 일반적으로 데이터스의 변경 이벤트를 배포</u>하는데 사용됩니다. 이러한 이벤트는 BigQuery 및 다른 데이터 스토리지 시스템에서 데이터베이스 상태 및 상태 기록의 뷰를 구성하는 데 사용될 수 있습니다. 

 * <b>병렬 처리 및 워크플로: </b> Pub/Sub 메시지를 사용하여 Cloud Function에 연결하면 여러 작업자 간에 많은 태스크를 효율적으로 배포할 수 있습니다. 이러한 테스크의 예시에는 텍스트 파일 압출, 이메일 알림 전송, Ai 모델 평가, 이미지 형식 재지정이 있습니다.

 * <b>엔터프라이즈 이벤트 버스: </b> 전사적 실시간 데이터 공유 버스를 만들어 비즈니스 이벤트, 데이터베이스 업데이트, 분석 이벤트를 조직 전체에 배포할 수 있습니다.

 * <b>애플리케이션, 서비스, Iot 기기에서 데이터 스트리밍: </b>예를 들어 Saas 애플리케이션은 이벤트의 실시간 피드를 게시할 수 있습니다. 또는 가정용 센서가 Dataflow 파이프라인을 통해 다른 Google Cloud 제품에서 사용할 수 있도록 Pub/Sub로 데이터를 스트리밍할 수 있습니다.

 * <b>분산 캐시 갱신: </b>예를 들어 애플리케이션이 무효화 이벤트를 게시하며, 변경된 객체의 Id를 업데이트합니다.

 * <b>안정성을 위한 부하 분산: </b> 서비스 인스턴스가 여러 영역에 있는 Compute engine에 배포되어도 공동 주제를 구독할 수 있습니다. 영역에 장애가 발생하면 나머지가 자동으로 부하를 선택합니다.

 ### Pub/Sub 서비스 유형
 * <b>Pub/Sub 서비스</b>이 메시지 서비스는 대부분의 사용자와 애플리케이션에서 기본적으로 사용되는 옵션입니다. 자동 용량 관리와 함께 가장 높은 안정성과 가장 큰 통합 기능을 제공합니다. Pub/Sub는 최소한 두 개 이상의 영역에 모든 데이터의 동기식 복제를 보장하고 세 번째 추가 영역에 최선의 복제를 보장합니다.

 * <b> Pub/Sub 라이트 서비스</b>: 저비용을 목적으로 하는 유사한 별개의 메시지 서비스. Pub/Sub 서비스에 비해 안전성이 낮은 편. 영역별 또는 리전별 주제 스토리지를 제공. 영역 라이트 주제는 하나의 영역에만 저장됩니다. 리전 라이트 주제는 데이터를 두 번째 영역에 비동기식으로 복제합니다. 또한 Pub/Sub 라이트로 사용하려면 스토리지 및 처리량 용량을 사전 프로비저닝하고 관리해야 합니다. Pub/Sub 라이트는 매우 저렴한 비용을 달성하는 것이 추가 운영 작업과 낮은 안정성을 상쇄하는 애플리케이션에만 적용됩니다. 


 ## Pub/Sub와 다른 메시징 기술 비교

 Pub/Sub는 <i>Apache Kafka</i> 및 <i>Pulsar</i>의 수평적 확장성을 Apache ActiveMQ 및 RabbitMQ와 같은 기존 메시징 미들웨어의 기능과 결합합니다. 이러한 기능의 예시에는 <b>데드 레터 큐</b>와 <b>필터링</b>이 있습니다.


 Pub/Sub가 메시징 미들웨어에서 사용하는 또 다른 기능은 파티션 기반 메시징이 아닌 <b>메시지당 동시 로드</b>입니다. Pub/Sub는 개별 메시지를 구독자 클라이언트에 '임대'한 다음 지정된 메시지가 성공적으로 처리되었는지 주기적으로 확인합니다.


 반대로 다른 수평 확장형 메시지 시스템은 수평 확장에 파티션을 사용합니다. 이렇게 하면 구독자가 각 파티션에서 메시지를 순서대로 처리해야 하며 동시 클라이언트 수가 파티션 수로 제합됩니다. 메시지당 처리는 구독자 애플리케이션의 동시 로드를 극대화하고 게시자/ 구독자의 독립성을 보장하는 데 도움이 됩니다.

### 서비스 간 통신 및 서비스-클라이언트 간 통신 비교

Pub/Sub의 용도는 최종 사용자 또는 Iot 클라이언트와의 통신이 아닌 서비스 간 통신입니다. 다른 제품에서는 다른 패턴이 더 잘 지원됩니다.

* <b>클라이언트-서버</b>: 모바일 웹/ 앱과 서비스 간에 메시지를 보내려면 Firebase 실시간 데이터베이스 및 Firebase 클라우드 메시징이 포함된 제품을 사용합니다.

* IoT-클라우드-서비스: IoT 앱과 서비스 간에 메시지를 보내려면 cloud UoT Core를 사용합니다.

* 비동기 서비스 호출: Cloud Tasks를 사용합니다.

# 통합

Pub/ Sub는 다른 Google Cloud 제품과 많이 통합되어 모든 기능을 갖춘 메시징 시스템 만듬

* <b>스트림 처리 및 데이터 통합</b>: Dataflow(Dataflow 템플릿/BigQuery/데이터 레이크)에서 지원되며 이를 통해 데이터를 처리하고 Cloud Storage에서 BigQuery 및 데이터 레이크에 데이터를 통합 가능. Pub/Sub 및 DataFlow UI에서도 사용할 수 있습니다. 기타 제품으로 데이터를 이동하는 Dataflow 템플릿은 GC console의 Pub/Sub 및 Dataflow UI에서도 사용. 특히, <B>Dataproc</B>으로 관리하는 경우, Apache Spark와의 통합도 사용할 수 있습니다. Spark + DataProc에서 실행되는 통합 및 처리 파이프라인의 시각적 구성은 Data Fusion을 사용하여 수행할 수 있습니다.

* <b> 모니터링, 알림, 로깅</b> Monitoring 및 Logging 제품에서 지원됩니다.

* <b>인증 및 IAM</b> Pub/Sub는 다른 Google Cloud 제품에서 사용하는 표준 Oauth 인증을 사용하며 세분화된 IAM을 지원하여 개별 리소스에 대한 액세스 제어를 지원합니다. 

* <b>API</b> Pub/Sub는 여러 언어의 클라이언트 라이브러리와 함께 표준 GRpc 및 REST 서비스 API 기술을 사용합니다.

* <b>트리거, 알림, 웹훅</b>: Pub/Sub는 웹훅에 대한 HTTP POST 요청으로 <u>푸시 기반의 메시지 전송을 제공</u>합니다.<u> Cloud Functions 또는 기타 서버리스 제품을 사용하여 워크플로 자동화를 쉽게 구현</u>할 수 있습니다. 

* <b>조정</b>: Pub/Sub 는 여러 단계의 서버리스 워클플로에 선언적으로 통합할 수 있습니다. 빅데이터 및 분석 조정은 종종 Pub/Sub 트리거를 지원하는 Cloud Composer로 이루어집니다. 또한 Pub/Sub를 Integration-Platform-as-a-Service 솔루션인 Application Integration과 통합할 수 있습니다. Application Integration은 통합을 트리거하거나 시작하는 Pub/Sub 트리거를 제공합니다.

* <b>통합 커넥터</b>: 이러한 커넥터를 사용하여 다양한 데이터 소스에 연결할 수 있습니다. 커넥터를 사용하면 Google Cloud 서비스 및 타사 비즈니스 애플리케이션이 모두 투명한 표준 인터페이스를 통해 통합에 제공됩니다. Pub/Sub의 경우, 통합에 사용할 Pub/Sub 연결을 만들 수 있습니다.